# InnoDB 가볍게 훑기

## 개요
이 문서는 MySQL의 기본 스토리지 엔진인 **InnoDB**의 주요 특징과 동작 원리를 간단히 설명합니다. InnoDB는 데이터베이스의 성능과 안정성을 높이는 여러 기능을 제공하며, 이를 이해하면 MySQL을 더 효과적으로 활용할 수 있습니다. 본 문서는 InnoDB와 MyISAM의 차이점을 중심으로, 외래 키 지원, 잠금 메커니즘, 트랜잭션 지원 및 ACID 보장 메커니즘 등을 다룹니다.

## 본문

### InnoDB란 무엇인가?
InnoDB는 MySQL 5.5 버전부터 기본 스토리지 엔진으로 채택된 스토리지 엔진입니다. 그 이전에는 **MyISAM**이 기본 엔진으로 사용되었습니다. InnoDB가 기본 엔진으로 전환된 이유는 데이터 무결성 보장, 동시성 향상, 트랜잭션 지원 등 다양한 장점을 제공하기 때문입니다.

### InnoDB와 MyISAM의 주요 차이점

#### 1. 외래 키 지원
- **InnoDB**는 외래 키를 지원하여 데이터베이스 레벨에서 참조 무결성을 자동으로 보장합니다.
- 반면, **MyISAM**은 외래 키를 지원하지 않으므로 애플리케이션 레벨에서 무결성을 유지하는 코드를 작성해야 합니다.

#### 2. 잠금 메커니즘
- **MyISAM**은 테이블 수준 잠금을 사용합니다. 이는 데이터 쓰기 작업 시 테이블 전체를 잠그며, 동시성 문제와 병목 현상을 초래할 수 있습니다.
- **InnoDB**는 레코드 수준 잠금을 지원하여 특정 레코드만 잠그므로 높은 동시성을 보장합니다. 다만, 실제로는 레코드 자체가 아닌 검색에 사용된 인덱스의 레코드를 잠급니다.
  - 예: 인덱스를 설정하지 않으면 기본 PK 인덱스를 사용하여 테이블 풀 스캔이 발생하며, 모든 PK 인덱스가 잠깁니다.

#### 3. 트랜잭션 지원
- **InnoDB**는 트랜잭션을 지원하며, 작업의 완전성과 데이터 정합성을 보장합니다.
- **MyISAM**은 트랜잭션을 지원하지 않아 작업 중 일부만 적용될 가능성이 있어 데이터 정합성이 깨질 수 있습니다.

### InnoDB의 ACID 보장 메커니즘
InnoDB는 데이터베이스 트랜잭션의 ACID 특성을 보장하기 위해 다양한 메커니즘을 제공합니다.

#### 1. 원자성 (Atomicity)
- **Undo 로그**: 트랜잭션 변경 이전 값을 기록하여 롤백 시 복구에 사용됩니다.
- **Redo 로그**: 트랜잭션 커밋 전에 변경 사항을 기록하여 장애 발생 시 복구합니다.

#### 2. 지속성 (Durability)
- Redo 로그는 디스크에 영구적으로 기록되며, 서버 장애 발생 시 마지막 커밋 상태를 복구할 수 있습니다.

#### 3. 일관성 (Consistency)
- 외래 키 제약 조건, 유니크 제약 조건 등 데이터 무결성 제약 조건을 통해 일관성을 유지합니다.

#### 4. 격리성 (Isolation)
- 네 가지 트랜잭션 격리 수준과 MVCC(Multi-Version Concurrency Control)를 활용합니다.
  - **MVCC**: 하나의 레코드에 대해 여러 버전을 관리하여 잠금을 걸지 않고도 동일한 트랜잭션 내에서 항상 같은 데이터를 조회할 수 있습니다. 이는 데이터베이스 동시성을 크게 향상시킵니다.

### 인덱스 설계의 중요성
InnoDB의 레코드 수준 잠금은 검색에 사용된 인덱스에 따라 잠금 범위가 달라집니다. 적절한 인덱스 설계를 통해 불필요한 잠금을 줄이고 성능을 최적화할 수 있습니다.

## 결론
InnoDB는 외래 키 지원, 레코드 수준 잠금, 트랜잭션 및 ACID 보장을 통해 MySQL 사용자에게 강력한 기능을 제공합니다. 특히 높은 동시성과 데이터 정합성이 중요한 환경에서 InnoDB의 장점은 더욱 두드러집니다. MySQL 공식 문서 및 관련 자료를 통해 InnoDB를 깊이 학습하면 더 나은 데이터베이스 설계를 할 수 있을 것입니다.